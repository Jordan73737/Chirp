{% extends 'base.html' %}

{% block title %}Feed{% endblock %}

{% block content %}
  <h2>Welcome, {{ user.username }}!</h2>

  <form method="POST">
    {{ form.hidden_tag() }}
    <p>
      {{ form.content.label }}<br>
      {{ form.content(rows=3, cols=60) }}
    </p>
    <p>{{ form.submit() }}</p>
  </form>

  <hr>

  {% for post in posts %}
    <div style="margin-bottom: 1.5em;">
      <strong>{{ post.author.username }}</strong>
      <small style="color: gray;">‚Äî {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
      <p>{{ post.content }}</p>

      <!-- Like Button with Count and Color Toggle -->
      <form method="POST" action="{{ url_for('main.like_post', post_id=post.id) }}" style="display:inline;">
        {{ like_form.hidden_tag() }}
        <button type="submit" style="background: none; border: none; font-size: 1.2em;">
          <span style="color: {% if post.id in liked_post_ids %}red{% else %}gray{% endif %};">
            {% if post.id in liked_post_ids %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
          </span>
          {{ post.likes|length }}
        </button>
      </form>

      <!-- Edit/Delete Buttons -->
      {% if post.author.id == current_user.id %}
        <a href="{{ url_for('main.edit_post', post_id=post.id) }}">Edit</a>
        <form method="POST" action="{{ url_for('main.delete_post', post_id=post.id) }}" style="display: inline;">
          {{ like_form.hidden_tag() }}
          <button type="submit" onclick="return confirm('Delete this post?')">Delete</button>
        </form>
      {% endif %}
      <hr>
    </div>
  {% else %}
    <p>No posts yet.</p>
  {% endfor %}
{% endblock %}
